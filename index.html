<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vane Store</title>
    
    <link rel="icon" href="logo-vane.png" type="image/png">
    
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS PARA LA MARCA DE AGUA (WATERMARK) --- */
        .boleta-card {
            position: relative;
            z-index: 1;
            overflow: hidden; 
        }

        .boleta-card::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            width: 280px; 
            height: 280px;
            background-image: url('logo-vane.png'); 
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.08; 
            pointer-events: none;
            z-index: -1;
        }

        @media print {
            .boleta-card::before {
                visibility: visible !important;
                opacity: 0.12 !important; 
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }

        /* --- ESTILOS PARA EL MODAL DE CONFIRMACI√ìN --- */
        .modal-vane {
            display: none; 
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-contenido {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: aparecer 0.3s ease;
        }

        @keyframes aparecer {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-icono { font-size: 3rem; margin-bottom: 10px; }
        .modal-botones { display: flex; gap: 10px; margin-top: 25px; }

        .btn-modal-si {
            flex: 1; background: #ff4757; color: white;
            border: none; padding: 12px; border-radius: 10px;
            font-weight: 800; cursor: pointer; font-family: 'Poppins', sans-serif;
        }

        .btn-modal-no {
            flex: 1; background: #f1f2f6; color: #2f3542;
            border: none; padding: 12px; border-radius: 10px;
            font-weight: 800; cursor: pointer; font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">VANE <span>STORE</span></div>
        <nav class="menu-superior">
            <button onclick="mostrarSeccion('pos')" class="btn-nav">üõí Ventas</button>
            <button onclick="mostrarSeccion('registro')" class="btn-nav btn-accent">üì¶ Nueva Mercader√≠a</button>
            <button onclick="mostrarSeccion('historial')" class="btn-nav" style="background: #2f3542; color: white;">üìã Historial</button>
        </nav>
    </header>

    <main id="sec-pos" class="pos-container">
        <section class="catalog-section">
            <div class="search-wrapper">
                <input type="text" id="pos-search" placeholder="Escanea c√≥digo o busca producto..." onkeyup="filtrarPOS(this.value)" autofocus>
            </div>
            <div id="grid-productos" class="grid-productos"></div>
        </section>

        <section class="checkout-section">
            <div class="boleta-card">
                <div class="boleta-header">
                    <h2 style="margin:0;">VANE STORE</h2>
                    <p style="margin:2px 0; font-size: 0.8rem;">RUC: 10612629230</p>
                    <p style="margin:2px 0; font-size: 0.8rem;">Calle 7 #170 Av. Buenos Aires</p>
                    <hr>
                    <div id="fecha-boleta" style="font-size: 0.75rem;"></div>
                    <div id="num-ticket" style="font-weight: bold; margin-bottom: 5px;"></div>
                    
                    <div style="text-align: left; margin-top: 10px;">
                        <small>Vendedor:</small><br>
                        <input type="text" id="vendedor-nombre" value="Personal" readonly>
                        <br>
                        <small>Cliente (DNI/RUC):</small><br>
                        <input type="text" id="cliente-dni" placeholder="________">
                    </div>
                </div>

                <div id="carrito-items" class="carrito-items"></div>

                <div class="boleta-footer">
                    <div class="total-row total-final">
                        <span>TOTAL A PAGAR:</span>
                        <span id="pos-total">S/ 0.00</span>
                    </div>

                    <div class="total-row">
                        <span>Paga con:</span>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span style="font-weight: 700; font-size: 1.1rem;">S/</span>
                            <input type="number" id="pago-cliente" placeholder="0.00" oninput="calcularVuelto()">
                        </div>
                    </div>
                    <div class="total-row" style="color: #2ed573; font-weight: 800; margin-bottom: 15px;">
                        <span>Vuelto:</span>
                        <span id="vuelto-cliente">S/ 0.00</span>
                    </div>
                    
                    <button class="btn-confirmar" onclick="finalizarVenta()">PAGAR E IMPRIMIR</button>
                    <button class="btn-vaciar" onclick="limpiarCarrito()">Vaciar Carrito</button>
                </div>
            </div>
        </section>
    </main>

    <section id="sec-registro" class="container-registro" style="display:none;">
        <div class="card-registro">
            <h2>üì¶ Registro de Mercader√≠a</h2>
            <div class="form-body">
                <div class="camera-box">
                    <label>Foto del Producto</label>
                    <video id="video" autoplay playsinline></video>
                    <canvas id="canvas" style="display:none;"></canvas>
                    
                    <button type="button" class="btn-snap" onclick="tomarFoto()">üì∏ CAPTURAR FOTO</button>

                    <div style="text-align: center; margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                        <p style="font-size: 0.8rem; color: #666; margin: 5px 0;">O selecciona una imagen de tu equipo:</p>
                        <input type="file" id="file-input" accept="image/*" onchange="cargarImagenDesdeArchivo(event)">
                    </div>

                    <div id="wrapper-preview" style="display:none;">
                        <img id="img-preview" src="">
                        <button type="button" class="btn-borrar-foto" onclick="borrarFotoActual()">‚úï</button>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <input type="text" id="prod-codigo" placeholder="C√≥digo de Barras (Escanea)">
                </div>
                <div class="form-group">
                    <input type="text" id="prod-nombre" placeholder="Nombre del Producto">
                </div>
                <div class="grid-inputs">
                    <input type="number" id="prod-precio" placeholder="Precio Venta S/">
                    <input type="number" id="prod-stock" placeholder="Stock Inicial">
                </div>
                <button class="btn-guardar-prod" onclick="guardarLocal()">GUARDAR EN INVENTARIO</button>
            </div>
        </div>
    </section>

    <section id="sec-historial" class="container-registro" style="display:none; flex-direction: column; align-items: center;">
        <div class="card-registro" style="max-width: 800px; width: 95%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                <h2 style="margin:0;">üìã Historial de Ventas</h2>
                <div style="display: flex; gap: 5px;">
                    <button onclick="exportarExcel()" style="background: #2ed573; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">üìä Excel</button>
                    <button onclick="limpiarHistorialTotal()" style="background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">Limpiar Todo</button>
                </div>
            </div>

            <div style="background: #f1f2f6; padding: 15px; border-radius: 12px; margin-bottom: 15px; display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;">
                <div>
                    <small>Desde:</small><br>
                    <input type="date" id="filtro-desde" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-family: 'Poppins', sans-serif;">
                </div>
                <div>
                    <small>Hasta:</small><br>
                    <input type="date" id="filtro-hasta" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-family: 'Poppins', sans-serif;">
                </div>
                <button onclick="renderHistorialFiltrado()" style="margin-top: 15px; background: #5352ed; color: white; border: none; padding: 7px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">Filtrar</button>
            </div>
            
            <div id="lista-ventas" style="max-height: 500px; overflow-y: auto; text-align: left;">
                </div>

            <div style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 15px; text-align: right;">
                <h3 id="total-dia" style="color: #2ed573;">Total Seleccionado: S/ 0.00</h3>
            </div>
        </div>
    </section>

    <div id="modal-confirmacion" class="modal-vane">
        <div class="modal-contenido">
            <div class="modal-icono">‚ö†Ô∏è</div>
            <h3 id="modal-titulo" style="margin: 0; font-weight: 800;">¬øEst√°s seguro(a)?</h3>
            <p id="modal-mensaje" style="color: #666; font-size: 0.9rem; margin-top: 10px;">Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-botones">
                <button id="btn-confirmar-accion" class="btn-modal-si">S√ç, CONTINUAR</button>
                <button onclick="cerrarModal()" class="btn-modal-no">CANCELAR</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCxeL-OTNLP3qluo-S5OuSWcWjYEjU4w5s",
        authDomain: "vanestore-pos.firebaseapp.com",
        databaseURL: "https://vanestore-pos-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "vanestore-pos",
        storageBucket: "vanestore-pos.firebasestorage.app",
        messagingSenderId: "559830889362",
        appId: "1:559830889362:web:b851f538a173194512c74b"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
    </script>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>
</html>